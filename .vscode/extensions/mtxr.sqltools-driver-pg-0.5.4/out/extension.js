var p=Object.defineProperty,y=Object.defineProperties,P=Object.getOwnPropertyDescriptor,k=Object.getOwnPropertyDescriptors,S=Object.getOwnPropertyNames,d=Object.getOwnPropertySymbols;var g=Object.prototype.hasOwnProperty,E=Object.prototype.propertyIsEnumerable;var u=(s,t,i)=>t in s?p(s,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[t]=i,v=(s,t)=>{for(var i in t||(t={}))g.call(t,i)&&u(s,i,t[i]);if(d)for(var i of d(t))E.call(t,i)&&u(s,i,t[i]);return s},h=(s,t)=>y(s,k(t));var f=(s,t)=>()=>(t||s((t={exports:{}}).exports,t),t.exports),O=(s,t)=>{for(var i in t)p(s,i,{get:t[i],enumerable:!0})},A=(s,t,i,c)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of S(t))!g.call(s,o)&&o!==i&&p(s,o,{get:()=>t[o],enumerable:!(c=P(t,o))||c.enumerable});return s};var D=s=>A(p({},"__esModule",{value:!0}),s);var m=f((x,L)=>{L.exports={name:"sqltools-driver-pg",displayName:"SQLTools PostgreSQL/Cockroach Driver",description:"SQLTools PostgreSQL/Cockroach Driver",version:"0.5.4",engines:{vscode:"^1.72.0"},publisher:"mtxr",license:"MIT",private:!0,repository:{type:"git",url:"https://github.com/mtxr/vscode-sqltools.git",directory:"packages/drivers.pg"},bugs:{url:"https://github.com/mtxr/vscode-sqltools/labels/pg"},keywords:["sqltools-driver","postgre","postgres","postgresql","cockroach","cockroachdb"],galleryBanner:{theme:"dark",color:"#333333"},icon:"icon.png",categories:["Programming Languages","Snippets","Formatters","Other"],extensionDependencies:["mtxr.sqltools"],activationEvents:["*","onLanguage:sql","onCommand:sqltools.*"],main:"./out/extension.js",scripts:{"test:tsc":"tsc --noEmit -p ./tsconfig.json --skipLibCheck",clean:"rimraf -rf out dist *.vsix",predev:"yarn run clean",dev:"yarn run watch",prebuild:"yarn run clean && yarn run tsc-check",build:'cross-env NODE_ENV=production concurrently "npm:build:*"',"build:ext":`yarn run compile:ext --define:process.env.NODE_ENV="'production'" --minify`,"build:ls":`yarn run compile:ls --define:process.env.NODE_ENV="'production'" --minify`,esbuild:"esbuild --platform=node --tsconfig=./tsconfig.json --external:vscode --color=true --format=cjs",prepackage:"yarn run build",package:"vsce package --yarn -o .","compile:ext":`yarn run esbuild --bundle ./src/extension.ts --outfile=./out/extension.js --target=es2017 --define:process.env.PRODUCT="'ext'"`,"compile:ls":`yarn run esbuild --bundle ./src/ls/plugin.ts --outfile=./out/ls/plugin.js --target=es2015 --define:process.env.PRODUCT="'ls'"`,"tsc-check":"yarn run ts --noEmit --preserveWatchOutput",watch:'concurrently "npm:watch:*"',"watch:ext":`yarn run compile:ext --define:process.env.NODE_ENV="'development'" --sourcemap --watch`,"watch:ls":`yarn run compile:ls --define:process.env.NODE_ENV="'development'" --sourcemap --watch`,"dev:tsc":"yarn run tsc-check -w",ts:"tsc -p ."},devDependencies:{"@sqltools/base-driver":"latest","@sqltools/types":"^0.1.6","@types/lodash":"^4.14.123","@types/pg":"^7.14.3","@types/vscode":"^1.72.0",concurrently:"^5.2.0",esbuild:"^0.15.7",lodash:"^4.17.19",pg:"^8.2.1",rimraf:"^3.0.2",typescript:"~4.8.3","@vscode/vsce":"^2.19.0"}}});var T={};O(T,{activate:()=>R,deactivate:()=>j});module.exports=D(T);var l=require("vscode");var n=[{displayName:"PostgreSQL",value:"PostgreSQL"},{displayName:"AWS Redshift",value:"AWS Redshift"},{displayName:"CockroachDB",value:"CockroachDB"}];var{publisher:N,name:q}=m(),b="PostgreSQL/Cockroach",w="sqltools-driver-credentials";async function R(s){let t=l.extensions.getExtension("mtxr.sqltools");if(!t)throw new Error("SQLTools not installed");await t.activate();let i=t.exports,c=`${N}.${q}`,o={extensionId:c,name:`${b} Plugin`,type:"driver",async register(e){e.resourcesMap().set(`driver/${n[0].value}/icons`,{active:s.asAbsolutePath("icons/pg/active.png"),default:s.asAbsolutePath("icons/pg/default.png"),inactive:s.asAbsolutePath("icons/pg/inactive.png")}),e.resourcesMap().set(`driver/${n[1].value}/icons`,{active:s.asAbsolutePath("icons/redshift/active.png"),inactive:s.asAbsolutePath("icons/redshift/inactive.png")}),e.resourcesMap().set(`driver/${n[2].value}/icons`,{active:s.asAbsolutePath("icons/cockroach/active.png"),default:s.asAbsolutePath("icons/cockroach/default.png"),inactive:s.asAbsolutePath("icons/cockroach/inactive.png")}),n.forEach(({value:r})=>{e.resourcesMap().set(`driver/${r}/extension-id`,c),e.resourcesMap().set(`driver/${r}/connection-schema`,s.asAbsolutePath("connection.schema.json")),e.resourcesMap().set(`driver/${r}/ui-schema`,s.asAbsolutePath("ui.schema.json"))}),await e.client.sendRequest("ls/RegisterPlugin",{path:s.asAbsolutePath("out/ls/plugin.js")})}};return i.registerPlugin(o),{driverName:b,parseBeforeSaveConnection:({connInfo:e})=>{let r=["connectionMethod","id","usePassword"];return e.usePassword&&(e.usePassword.toString().toLowerCase().includes("ask")?(e.askForPassword=!0,r.push("password")):e.usePassword.toString().toLowerCase().includes("empty")?(e.password="",r.push("askForPassword")):e.usePassword.toString().toLowerCase().includes("save")?r.push("askForPassword"):e.usePassword.toString().toLowerCase().includes("secure")&&(r.push("password"),r.push("askForPassword"))),e.connectString&&(r.push("port"),r.push("askForPassword")),r.forEach(a=>delete e[a]),e.pgOptions=e.pgOptions||{},e.pgOptions.enableSsl==="Enabled"?typeof e.pgOptions.ssl=="object"&&Object.keys(e.pgOptions.ssl).length===0&&(e.pgOptions.ssl=!0):e.pgOptions.enableSsl==="Disabled"&&delete e.pgOptions.ssl,delete e.pgOptions.enableSsl,Object.keys(e.pgOptions).length===0&&delete e.pgOptions,e},parseBeforeEditConnection:({connInfo:e})=>{let r=h(v({},e),{connectionMethod:"Server and Port"});return e.socketPath?r.connectionMethod="Socket File":e.connectString&&(r.connectionMethod="Connection String"),e.askForPassword?(r.usePassword="Ask on connect",delete r.password):typeof e.password=="string"?(delete r.askForPassword,r.usePassword=e.password?"Save as plaintext in settings":"Use empty password"):r.usePassword="SQLTools Driver Credentials",r.pgOptions=r.pgOptions||{},r.pgOptions.ssl?(r.pgOptions.enableSsl="Enabled",typeof r.pgOptions.ssl=="boolean"&&(r.pgOptions.ssl={})):r.pgOptions.enableSsl="Disabled",r},resolveConnection:async({connInfo:e})=>{if(e.password===void 0&&!e.askForPassword&&!e.connectString){let r=[e.name,e.username||""],a=await l.authentication.getSession(w,r,{silent:!0});a||(a=await l.authentication.getSession(w,r,{createIfNone:!0})),a&&(e.password=a.accessToken)}return e},driverAliases:n}}function j(){}0&&(module.exports={activate,deactivate});
